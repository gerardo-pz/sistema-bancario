{% extends "usuarios/base.html" %}

{% block content %}
<div class="container mt-5">
    <h3>Movimientos de la cuenta {{ cuenta.numero_cuenta }}</h3>
    <form method="get" class="row g-2 mb-4">
        <div class="col-md-2">
            <select name="tipo" class="form-select">
                <option value="">Todos los tipos</option>
                <option value="DEPOSITO" {% if tipo == "DEPOSITO" %}selected{% endif %}>Depósito</option>
                <option value="RETIRO" {% if tipo == "RETIRO" %}selected{% endif %}>Retiro</option>
                <option value="TRANSFERENCIA" {% if tipo == "TRANSFERENCIA" %}selected{% endif %}>Transferencia</option>
            </select>
        </div>
        <div class="col-md-2">
            <input type="date" name="fecha_inicio" class="form-control" value="{{ fecha_inicio }}">
        </div>
        <div class="col-md-2">
            <input type="date" name="fecha_fin" class="form-control" value="{{ fecha_fin }}">
        </div>
        <div class="col-md-2">
            <input type="number" step="0.01" name="monto_min" class="form-control" placeholder="Monto mínimo" value="{{ monto_min }}">
        </div>
        <div class="col-md-2">
            <input type="number" step="0.01" name="monto_max" class="form-control" placeholder="Monto máximo" value="{{ monto_max }}">
        </div>
        <div class="col-md-2">
            <input type="text" name="descripcion" class="form-control" placeholder="Descripción" value="{{ descripcion }}">
        </div>
        <div class="col-md-2">
            <select name="orden" class="form-select">
                <option value="fecha_desc" {% if orden == "fecha_desc" %}selected{% endif %}>Más reciente</option>
                <option value="fecha_asc" {% if orden == "fecha_asc" %}selected{% endif %}>Más antiguo</option>
                <option value="monto_desc" {% if orden == "monto_desc" %}selected{% endif %}>Monto mayor</option>
                <option value="monto_asc" {% if orden == "monto_asc" %}selected{% endif %}>Monto menor</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Filtrar</button>
        </div>
    </form>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Monto</th>
                    <th>Cuenta destino/origen</th>
                    <th>Descripción</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transacciones %}
                <tr>
                    <td>{{ t.fecha|date:"d/m/Y H:i" }}</td>
                    <td>{{ t.tipo }}</td>
                    <td>
                        {% if t.cuenta_origen == cuenta %}
                            <span class="text-danger">- S/. {{ t.monto }}</span>
                        {% else %}
                            <span class="text-success">+ S/. {{ t.monto }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if t.tipo == "TRANSFERENCIA" %}
                            {% if t.cuenta_origen == cuenta %}
                                {{ t.cuenta_destino.numero_cuenta }}
                            {% else %}
                                {{ t.cuenta_origen.numero_cuenta }}
                            {% endif %}
                        {% else %}
                            ---
                        {% endif %}
                    </td>
                    <td>{{ t.descripcion|default:"-" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">No hay movimientos para mostrar.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <a href="{% url 'detalle_cuenta' cuenta.id %}" class="btn btn-secondary mt-3">Volver</a>
</div>
{% endblock %}